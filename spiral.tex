\documentclass[twocolumn,DIV18]{scrartcl}
\usepackage{amsmath}
\usepackage{graphicx}
\newcommand{\abs}[1]{\lvert #1 \rvert}
\renewcommand{\(}{\left(}
\renewcommand{\)}{\right)}
%\newcommand{\eqref}[1]{(\ref{#1})}
\begin{document}
\title{Equidistant spiral sampling}
\author{Martin Kielhorn}
\maketitle
\section{Introduction}
We want to illuminate different points in the back focal plane of a
micro objective. Its convenient to have a 1D indexing scheme for these
points. Due to the circular symmetry a spiral sampling [1983Ahn] comes
to mind. 

\section{Archimedes Spiral}
An Archimedes spiral in polar coordinates $(r,\theta)$ is defined like
this:
\begin{align}
  r(\theta)=a\,\theta.
\end{align}
The step height $h$ of the spiral is given by
\begin{align}
  h=\abs{r(\theta)-r(\theta+2\pi)}=r(2\pi)=2\pi a.
\end{align}
\section{Equidistance sampling}
We want to start sampling in the center at $r(0)=0$ and sample the arc
length of the spiral with equidistant points. The arc length of an
archimedes spiral is [Weisstein]:
\begin{align} \label{eqn:arclength}
  s(\theta)=\frac{a}{2}\(p\,\theta + \log(p\,\theta)\)\quad\textrm{with}\quad
  p=\sqrt{1+\theta^2}.
\end{align}
The arc length $\Delta s$ between successive points along the spiral
should be equal to the step height $h$. Starting from the central
point $\theta_0=0$ the arc length where to sample the $i-$th point can
be obtained by inverting equation \eqref{eqn:arclength}:
\begin{align}
  \theta_i=\theta(i\,\Delta s).
\end{align}
This inversion can be done efficiently with Newton interation
[Wikipedia]:
\begin{align}
  x_0&=1,\\
  x_{n+1}&=x_n-\frac{f(x)}{f'(x)}.
\end{align}
Here we introduce the function $f(\theta)$ that vanishes at a given arc
length $s$ and its derivative $f'(\theta)$:
\begin{align}
  \label{eqn:f}
  f(\theta)&=\frac{a}{2}\(p\,\theta+\log(p\,\theta)\)-s,\\
  f'(\theta)&=\frac{\partial f(\theta)}{\partial \theta}=
  \frac{a}{2}\frac{(2\theta^2+1)(\theta p + 1)}{\theta p^2}.
\end{align}
\section{Filling the back focal plane}
Given the number $n$ of sampling points and the desired radius of the
back focal plane $R$ the parameter $a$ and the value of $\theta_n$ can
be determined by solving the following non-linear system of
equations. The first equation states that the spiral intersects the
circle with radius $R$ at the discrete angle $\theta_n$. The second
equation defines the sample length $\Delta s$ along the arc to be
equal to the step height $h$ of the spiral:
\begin{align}
  r(\theta_n)=R, \quad \Delta s=h.
\end{align}
Equivalently we may write:
\begin{align} \label{eqn:2d2}
  a \, \theta(n \Delta s)=R, \quad \Delta s=2\pi a.
\end{align}
We introduce \eqref{eqn:arclength} into the left equation as we did in
the construction of \eqref{eqn:f}:
\begin{align}
  a \, \frac{a}{2} \(p\,\theta+\log(p\,\theta)\) = R+n\Delta s. 
\end{align}
Now we replace $\Delta s$ with the right equation from
\eqref{eqn:2d2}, and divide by $a$:
\begin{align}
  \frac{a}{2} \(p\,\theta+\log(p\,\theta)\) = R/a +2\pi n. 
\end{align}
We reformulate the equation system as:
\begin{align}
  f_1(\theta,a)&=\frac{a}{2}\(p\,\theta+\log(p\,\theta)\)-2\pi n-R/a,\\
  f_2(\theta,a)&=a\,\theta-R. 
\end{align}
Its Jacobian is:
\begin{align}
  J(\theta,a)=\begin{pmatrix}
  f_{1,\theta} & f_{1,a} \\
  f_{2,\theta} & f_{2,a}
\end{pmatrix}.
\end{align}
With the derivatives
\begin{align}
  f_{1,\theta}&=\frac{a}{2}\frac{(2\theta^2+1)(\theta p + 1)}{\theta p^2},\\ 
  f_{1,a}&=\frac{R}{a^2}\frac{1}{2}\(p\theta+\log(p\theta)\), \\
  f_{2,\theta}&=a, \\
  f_{2,a}&=\theta.
\end{align}
The inverse of the Jacobian is:
\begin{align}
J^{-1}(\theta,a)=\frac{\begin{pmatrix}
    \theta & -(p\theta+\log p\theta)/2-R/\theta^2 \\
    -a & ap\\
\end{pmatrix}}
{ap\,\theta-a\(\(p\theta+\log p\theta\)/2+R/\theta^2\)}
\end{align}
The iteration step for the Newton method is:
\begin{align}
  \begin{pmatrix}\theta_{n+1}\\a_{n+1}\end{pmatrix}=
  \begin{pmatrix}\theta_n\\a_n\end{pmatrix}
  -J^{-1}(\theta_n,a_n)
  \begin{pmatrix}f_1(\theta_n,a_n)\\f_2(\theta_n,a_n)\end{pmatrix}.
\end{align}
\begin{figure}[h]
  \begin{center}
    \includegraphics[width=.3\columnwidth]{200}
    \includegraphics[width=.3\columnwidth]{1000}
    \includegraphics[width=.3\columnwidth]{2000}
  \end{center}
  \caption{Equidistant sampling of a circle of the same diameter
    $R=100$ with 200 (left), 1000 (middle) and 2000 (right)
    points.}
\end{figure}
\end{document}
%% FindRoot[{a x == R, a/2 (Sqrt[1+x^2]x+Log[Sqrt[1+x^2]x]) == n * 2 pi a + R/a}, {{x, 1}, {a, 1}}]

%% @ARTICLE{4307732,
%% author={Ahn, C. B. and Kim, J. H. and Cho, Z. H.},
%% journal={Medical Imaging, IEEE Transactions on}, title={High-Speed Spiral-Scan Echo Planar NMR Imaging-I},
%% year={1986},
%% month={mar.},
%% volume={5},
%% number={1},
%% pages={2 -7},
%% keywords={},
%% doi={10.1109/TMI.1986.4307732},
%% ISSN={0278-0062},}

%% Weisstein, Eric W. "Archimedes' Spiral." From MathWorld--A Wolfram
%% Web Resource. http://mathworld.wolfram.com/ArchimedesSpiral.html


%% http://en.wikipedia.org/wiki/Newton's_method

%% multidimensional newton method
%% http://math.fullerton.edu/mathews/n2003/NewtonSystemMod.html
